<div class="row">
  <div class="col-md-12">
    <ol class="breadcrumb">
      <%= list_item_to_lessons %>
      <%= list_item_to_lessons_of_month @date.strftime("%Y%m") %>
      <%= list_item_to_lessons_of_day @date, active: true %>
    </ol>
  </div>
</div>
<div class="row">
  <div class="col-md-12">
    <%= form_tag lessons_path, method: :get, class: "form-inline" do %>
      <%= hidden_field_tag :date, @date.strftime("%Y%m%d") %>
      <div class="form-group">
        <%= select_tag :school_id, options_from_collection_for_select(School.all, :id, :name, params[:school_id]), class: "form-control", include_blank: true %>
      </div>
      <%= button_to_search %>
    <% end %>
  </div>
</div>
<br />
<div class="row">
  <div class="col-md-12">
    <div class="table-responsive">
      <table class="table table-striped table-condensed table-hover">
        <thead>
          <tr>
            <th><%= t("activerecord.models.school") %></th>
            <th><%= t("activerecord.models.studio") %></th>
            <th><%= t("activerecord.models.time_slot") %></th>
            <th><%= t("activerecord.attributes.lesson.course_id") %></th>
            <% if false %>
            <th><%= t("activerecord.models.course") %></th>
            <th><%= t("activerecord.models.instructor") %></th>
            <% end %>
            <th><%= t("activerecord.models.member") %></th>
            <th><%= t("activerecord.attributes.lesson.rolls_status") %></th>
            <th>出席</th>
            <th>欠席</th>
            <th>振替</th>
            <th>休会</th>
            <th></th>
          </tr>
        </thead>
        <tbody>
          <% @lessons.each do |lesson| %>
            <% course = @courses.find {|course| course.id == lesson.course_id } %>
            <tr>
              <td><%= course.timetable.studio.school.name %></td>
              <td><%= course.timetable.studio.name %></td>
              <td><%= course.timetable.time_slot.start_time %></td>
              <td><%= course.name %></td>
            <% if false %>
              <td><%= course.decorate.name %></td>
              <td><%= course.instructor.decorate.name %></td>
            <% end %>
              <td><%= lesson.number_of_members %></td>
              <td><%= lesson.rolls_status %></td>
              <td><%= lesson.present_rolls %></div></td>
              <td><%= lesson.absent_rolls %></td>
              <td><%= lesson.substitute_rolls %></td>
              <td><%= lesson.recess_rolls %></td>
              <td>
                <% if lesson.new_record? %>
                  <%= form_for(lesson) do |f| %>
                    <%= f.hidden_field :course_id %>
                    <%= f.hidden_field :date %>
                    <%= f.hidden_field :rolls_status %>
                    <%= button_tag class: "btn btn-link" do %>
                      <%= icon_to_show %>
                    <% end %>
                  <% end %>
                <% else %>
                  <%= link_to_show lesson_rolls_path(lesson) %>
                <% end %>
              </td>
            </tr>
          <% end %>
        </tbody>
      </table>
    </div>
    <ul class="pager">
      <li class="previous">
        <%= link_to_yesterdays_lessons @date, params[:school_id] %>
      </li>
      <li class="next">
        <%= link_to_tomorrows_lessons @date, params[:school_id] %>
      </li>
    </ul>
  </div>
</div>
<br />
<div class="row">
  <div class="col-md-12">
    <%= button_to_back lessons_path(month: @date.strftime("%Y%m")), pull: "left" %>
  </div>
</div>

